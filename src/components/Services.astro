---
// Servicios Destacados - Carrusel
// Fondo: Blanco puro
// Tarjetas: Minimalistas con borde gris claro (#A1A0A0)

const services = [
  {
    id: 1,
    title: "Cooltech Define",
    description: "Redefine tu contorno. Tecnología avanzada de crioadiposidad.",
    icon: "cooltech",
    link: "/tratamientos/cooltech-define"
  },
  {
    id: 2,
    title: "Rejuvenecimiento Facial",
    description: "Luminosidad y firmeza que respetan tus facciones.",
    icon: "facial",
    link: "/tratamientos/rejuvenecimiento-facial"
  },
  {
    id: 3,
    title: "Tratamientos Post-Maternidad",
    description: "Recupera tu confianza. Soluciones para madres de hoy.",
    icon: "postmaternity",
    link: "/tratamientos/post-maternidad"
  },
  {
    id: 4,
    title: "Bioestimuladores",
    description: "Estimula tu colágeno natural para una piel más firme.",
    icon: "bio",
    link: "/tratamientos/bioestimuladores"
  },
  {
    id: 5,
    title: "Armonización Facial",
    description: "Equilibrio y proporción para realzar tu belleza única.",
    icon: "harmony",
    link: "/tratamientos/armonizacion-facial"
  }
];
---

<section class="services" id="servicios">
  <!-- Fondo con parallax -->
  <div class="services-background">
    <div class="services-parallax-bg" id="services-parallax-bg"></div>
    <div class="services-overlay"></div>
  </div>

  <div class="services-container">
    <!-- Header de sección -->
    <div class="services-header">
      <span class="section-label">Nuestros Tratamientos</span>
      <h2 class="services-title">Servicios <em>Destacados</em></h2>
      <p class="services-subtitle">
        Descubre nuestras soluciones diseñadas para realzar tu belleza natural
      </p>
    </div>

    <!-- Carrusel -->
    <div class="carousel-wrapper">
      <div class="carousel" id="services-carousel">
        {services.map((service) => (
          <article class="service-card" data-service={service.id}>
            <div class="card-icon">
              {service.icon === "cooltech" && (
                <svg viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="30" cy="30" r="25" stroke="#606060" stroke-width="1"/>
                  <path d="M30 15V45M20 25L30 15L40 25M20 35L30 45L40 35" stroke="#606060" stroke-width="1.5"/>
                </svg>
              )}
              {service.icon === "facial" && (
                <svg viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <ellipse cx="30" cy="32" rx="18" ry="22" stroke="#606060" stroke-width="1"/>
                  <circle cx="24" cy="28" r="2" fill="#606060"/>
                  <circle cx="36" cy="28" r="2" fill="#606060"/>
                  <path d="M26 38C26 38 28 41 30 41C32 41 34 38 34 38" stroke="#606060" stroke-width="1"/>
                </svg>
              )}
              {service.icon === "postmaternity" && (
                <svg viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M30 10C30 10 15 20 15 35C15 45 22 50 30 50C38 50 45 45 45 35C45 20 30 10 30 10Z" 
                        stroke="#606060" stroke-width="1"/>
                  <circle cx="30" cy="32" r="8" stroke="#606060" stroke-width="1"/>
                </svg>
              )}
              {service.icon === "bio" && (
                <svg viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="30" cy="30" r="8" stroke="#606060" stroke-width="1"/>
                  <circle cx="30" cy="30" r="16" stroke="#606060" stroke-width="1" stroke-dasharray="4 4"/>
                  <circle cx="30" cy="30" r="24" stroke="#606060" stroke-width="1" stroke-dasharray="2 2"/>
                </svg>
              )}
              {service.icon === "harmony" && (
                <svg viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M30 10L50 50H10L30 10Z" stroke="#606060" stroke-width="1"/>
                  <circle cx="30" cy="35" r="10" stroke="#606060" stroke-width="1"/>
                </svg>
              )}
            </div>
            
            <h3 class="card-title">{service.title}</h3>
            <p class="card-description">{service.description}</p>
            
            <a href={service.link} class="card-link">
              Conocer más
              <svg class="arrow-icon" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M4 10H16M16 10L11 5M16 10L11 15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </a>
          </article>
        ))}
      </div>

      <!-- Controles del carrusel -->
      <button class="carousel-btn carousel-prev" aria-label="Anterior">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button class="carousel-btn carousel-next" aria-label="Siguiente">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>

    <!-- Indicadores -->
    <div class="carousel-indicators" id="carousel-indicators">
      {services.map((_, index) => (
        <button 
          class={`indicator ${index === 0 ? 'active' : ''}`} 
          data-index={index}
          aria-label={`Ir al servicio ${index + 1}`}
        ></button>
      ))}
    </div>
  </div>
</section>

<style>
  .services {
    position: relative;
    padding: 8rem 0;
    overflow: hidden;
  }

  /* Fondo Parallax */
  .services-background {
    position: absolute;
    inset: 0;
    z-index: 0;
    overflow: hidden;
  }

  .services-parallax-bg {
    position: absolute;
    top: -30%;
    left: 0;
    width: 100%;
    height: 160%;
    background-image: url('/assets/bg_page.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    will-change: transform;
    transition: transform 0.1s ease-out;
  }

  .services-overlay {
    position: absolute;
    inset: 0;
    
  }

  .services-container {
    position: relative;
    z-index: 1;
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
  }

  /* Header */
  .services-header {
    text-align: center;
    margin-bottom: 4rem;
  }

  .section-label {
    display: inline-block;
    font-family: var(--font-body);
    font-size: 0.75rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.2em;
    color: var(--color-gray-light);
    margin-bottom: 1rem;
  }

  .services-title {
    font-family: var(--font-titles);
    font-size: clamp(2rem, 4vw, 3rem);
    font-weight: 600;
    color: var(--color-black);
    margin-bottom: 1rem;
  }

  .services-title em {
    font-style: italic;
    color: var(--color-gray-medium);
  }

  .services-subtitle {
    font-family: var(--font-body);
    font-size: 1rem;
    font-weight: 300;
    color: var(--color-gray-light);
    max-width: 500px;
    margin: 0 auto;
  }

  /* Carrusel */
  .carousel-wrapper {
    position: relative;
    overflow: hidden;
  }

  .carousel {
    display: flex;
    gap: 2rem;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scrollbar-width: none;
    -ms-overflow-style: none;
    padding: 1rem 0;
  }

  .carousel::-webkit-scrollbar {
    display: none;
  }

  /* Tarjetas */
  .service-card {
    flex: 0 0 calc(33.333% - 1.5rem);
    min-width: 300px;
    scroll-snap-align: start;
    background-color: var(--color-white);
    border: 1px solid var(--color-gray-light);
    padding: 2.5rem 2rem;
    transition: var(--transition-smooth);
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }

  .service-card:hover {
    border-color: var(--color-gray-medium);
    box-shadow: var(--shadow-card);
    transform: translateY(-4px);
  }

  .card-icon {
    width: 60px;
    height: 60px;
    margin-bottom: 1.5rem;
  }

  .card-icon svg {
    width: 100%;
    height: 100%;
  }

  .card-title {
    font-family: var(--font-titles);
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--color-black);
    margin-bottom: 0.75rem;
  }

  .card-description {
    font-family: var(--font-body);
    font-size: 0.9375rem;
    font-weight: 300;
    line-height: 1.7;
    color: var(--color-gray-medium);
    margin-bottom: 1.5rem;
    flex-grow: 1;
  }

  .card-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-family: var(--font-body);
    font-size: 0.875rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-gray-medium);
    transition: var(--transition-smooth);
  }

  .card-link:hover {
    color: var(--color-black);
    gap: 0.75rem;
  }

  .arrow-icon {
    width: 20px;
    height: 20px;
    transition: var(--transition-smooth);
  }

  /* Controles */
  .carousel-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 48px;
    height: 48px;
    background-color: var(--color-white);
    border: 1px solid var(--color-gray-light);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition-smooth);
    z-index: 10;
  }

  .carousel-btn:hover {
    background-color: var(--color-gray-medium);
    border-color: var(--color-gray-medium);
    color: var(--color-white);
  }

  .carousel-btn svg {
    width: 24px;
    height: 24px;
  }

  .carousel-prev {
    left: 0;
  }

  .carousel-next {
    right: 0;
  }

  /* Indicadores */
  .carousel-indicators {
    display: flex;
    justify-content: center;
    gap: 0.75rem;
    margin-top: 2rem;
  }

  .indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: var(--color-gray-light);
    border: none;
    cursor: pointer;
    transition: var(--transition-smooth);
  }

  .indicator.active,
  .indicator:hover {
    background-color: var(--color-gray-medium);
    transform: scale(1.2);
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .service-card {
      flex: 0 0 calc(50% - 1rem);
    }

    .carousel-btn {
      display: none;
    }
  }

  @media (max-width: 640px) {
    .services {
      padding: 5rem 0;
    }

    .service-card {
      flex: 0 0 85%;
      min-width: unset;
    }
  }

  /* Deshabilitar parallax si el usuario prefiere movimiento reducido */
  @media (prefers-reduced-motion: reduce) {
    .services-parallax-bg {
      transform: none !important;
    }
  }
</style>

<script>
  // Parallax effect para Services
  const servicesSection = document.getElementById('servicios');
  const servicesParallaxBg = document.getElementById('services-parallax-bg');
  
  if (servicesSection && servicesParallaxBg) {
    let ticking = false;
    
    function updateServicesParallax() {
      if (!servicesSection || !servicesParallaxBg) return;
      
      const rect = servicesSection.getBoundingClientRect();
      const windowHeight = window.innerHeight;
      
      // Solo aplicar parallax cuando la sección está visible
      if (rect.top < windowHeight && rect.bottom > 0) {
        const scrollProgress = (windowHeight - rect.top) / (windowHeight + rect.height);
        const yPos = (scrollProgress - 0.5) * 100; // Factor de velocidad del parallax
        servicesParallaxBg.style.transform = `translate3d(0, ${yPos}px, 0)`;
      }
      
      ticking = false;
    }
    
    window.addEventListener('scroll', () => {
      if (!ticking) {
        requestAnimationFrame(updateServicesParallax);
        ticking = true;
      }
    }, { passive: true });
    
    // Ejecutar una vez al cargar
    updateServicesParallax();
  }

  // Carrusel functionality
  const carousel = document.getElementById('services-carousel');
  const prevBtn = document.querySelector('.carousel-prev');
  const nextBtn = document.querySelector('.carousel-next');
  const indicators = document.querySelectorAll('.indicator');
  const cards = document.querySelectorAll('.service-card');

  let currentIndex = 0;

  function scrollToIndex(index: number) {
    if (carousel && cards.length > 0) {
      const card = cards[index] as HTMLElement;
      const scrollPosition = card.offsetLeft - carousel.offsetLeft;
      carousel.scrollTo({ left: scrollPosition, behavior: 'smooth' });
      
      indicators.forEach((ind, i) => {
        ind.classList.toggle('active', i === index);
      });
      currentIndex = index;
    }
  }

  prevBtn?.addEventListener('click', () => {
    const newIndex = currentIndex > 0 ? currentIndex - 1 : cards.length - 1;
    scrollToIndex(newIndex);
  });

  nextBtn?.addEventListener('click', () => {
    const newIndex = currentIndex < cards.length - 1 ? currentIndex + 1 : 0;
    scrollToIndex(newIndex);
  });

  indicators.forEach((indicator, index) => {
    indicator.addEventListener('click', () => scrollToIndex(index));
  });

  // Update indicator on scroll
  carousel?.addEventListener('scroll', () => {
    const scrollLeft = carousel.scrollLeft;
    const cardWidth = (cards[0] as HTMLElement).offsetWidth + 32; // width + gap
    const newIndex = Math.round(scrollLeft / cardWidth);
    
    if (newIndex !== currentIndex && newIndex >= 0 && newIndex < cards.length) {
      indicators.forEach((ind, i) => {
        ind.classList.toggle('active', i === newIndex);
      });
      currentIndex = newIndex;
    }
  });
</script>
